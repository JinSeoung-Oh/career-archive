프로젝트명: Image Generation with Text (조건 기반 생성)
업데이트일: 2023-08-25 / 2023-08-30

1) InST (Style transformer with diffusion) — 2023-08-25
   - 개요: SD v1 inference를 역활용한 스타일 전이. 제공 스타일 4종(Andre Derain, longhair, modern, woman). 원본+스타일(가이드) 이미지 입력.
   - 확장: 추가 스타일은 학습 코드로 스타일 임베딩(embedding.pt) 생성 필요.
   - 결과: 예시에서 원본→스타일 일관 전환 확인(샘플 제공). 스타일 강도/경계 처리는 프롬프트·스텝·CFG로 미세 조정 권장.

2) Stable Diffusion v2-depth — 2023-08-30
   - 개요: Depth 추정 → Depth 조건 합성으로 원본의 구도/포즈 유지, 내용/스타일만 변환.
   - 관찰 포인트
     -1) Negative prompt 무시/역반영 사례: 동일 프롬프트 반복 시 결과 품질이 점차 저하되는 drift 관찰.
     -2) 다인 장면에서 제약 증가: negative prompt 효과 약화, 원본과 괴리 큰 합성 발생 → “not very different from original image”와 같은 제약 문구 보조 필요.
     -3) 편향 이슈: 한국어/아시아 조건에서 피부 톤·안구 형태 왜곡, ‘big eyes’ 사용 시 아티팩트.
     -4) 해상도/정합: depth map 해상도 불일치 시 품질 저하.
   - 활용 메모
     -1) Snow류 상용 필터의 동작과 유사한 depth-conditioned 합성 징후 확인(추정).
     -2) 특정 캐릭터 전용 LoRA/모델(Civitai 계열)을 depth2img 파이프라인에 조건 결합하면 “원본 구도 유지 + 특정 인물 스타일” 필터화 가능(추가 merge/inpaint 필요).

3) Stable Diffusion v2-inpainting — 2023-08-30
   - 개요: 마스크 지정 영역만 부분 생성 → 원본에 캐스팅.
   - 관찰 포인트
     -1) 마스크 품질(경계/헤어라인/반사광)에 매우 민감.
     -2) 결과 안정성 편차 존재: 프롬프트·샘플러·스텝·씨드 영향 큼.
   - 권장 세팅
     -1) 정교한 세그멘테이션 마스크(예: BiSeNet/ModNet/FaceMatte) + 경계 feathering.
     -2) 색·질감 매칭(histogram/brightness/contrast/grain) 후 합성.

4. 무엇을 알 수 있었는가 (Insights)
    -1. “텍스트=조건” 접근은 전역 생성보다 안정적이나, 품질은 전처리/정합에 좌우
        - Depth·Inpaint·Style 전이는 정교한 마스크/깊이/정합이 핵심. 생성모델 성능만으론 한계.
    -2. Negative prompt/다인 장면에서의 제약
        - negative가 무시·역반영되는 케이스 빈번. 다인/복잡 장면일수록 depth·세그멘트별 분할 처리로 파이프라인을 세분화해야 안정.
    -3. 편향 및 언어 이슈 존재
        - 한국어/아시아 조건에서 스테레오타입 출력 경향. 안전 프롬프트 템플릿, 사후 편향 필터링 필요.
    -4. 재현성 확보는 “프롬프트/씨드/스텝/CFG” 고정 + 그리드 서치
        - 반복 샘플링 시 품질 drift → seed 고정과 자동 스윕으로 최적 조합을 찾고 기록해야 함.
    -5. 상용 필터 수준 안정성에는 후처리 룰이 필요
        - 경계 제거(Feather/TPS), 색/샤프니스 매칭, 실패 케이스 fallback 규칙(원본 유지/보수적 변환)이 있어야 사용자 체감 품질이 일정.

5. 제안 워크플로(실무 적용)
   -1. 분할 파이프라인:
       -1) 사람/얼굴/헤어 세그멘테이션 → 정밀 마스크
       -2) Depth-conditioned 합성으로 포즈 유지
       -3) 필요한 영역만 Inpainting(텍스처/피부 보정은 별도 프롬프트)
       -4) 정합/후처리: 랜드마크 기반 워핑 + 색/노이즈/샤픈 매칭
       -5) 평가/필터: 편향·NSFW·아티팩트 감지, 실패 시 보수적 대체
   -2. 운영 자동화: 프롬프트/씨드/스케줄러/스텝 그리드 서치 → 베스트 설정 캐시, 장면 복잡도(사람 수/얼굴 크기/조명)에 따른 룰 기반 분기.
