데이터 증강 – 국민카드 NER 후속 작업 (2024.08–09)

1. 개요
   - 역할: 프롬프트/데이터 파이프라인 설계 및 구현
   - 목표: 약 3,500건의 원시 문서(raw)를 바탕으로 동의어 치환/개체 치환/문장 재배열 등으로 5배수 수준의 증강 데이터 확보
   - 맥락: PML-90: 국민카드 NER key-value 추출 후속. 시드 문서의 레이아웃/포맷은 유지, 개체(Entity)만 안전하게 교체하도록 설계

2. 제약 조건
   - 카테고리 보존: 원본이 ‘법원’이면 증강도 ‘법원’만 교체 대상. (금융/세무/영장 등도 동일 원칙)
   - 엔티티 레벨 매칭: org-dep-team-case 동일 계층끼리만 교체 (세트 종속성 유지)
   - POS 제약: 문서 카테고리별 허용 POS 내에서만 치환 (예: 법원주사/법원주사보/법원사무관 등)
   - 경찰조직 종속성: @@경찰청–##경찰서 휘하 관계 매핑표를 따라 교체
   - 형태 보존: 문서 포맷/구조는 유지, 조사·조어 자연스러움 보장
   - 의미적 정확성은 중요도 낮음: 포맷·개체 정합성 우선(고객사 지침)
   - 데이터 품질 이슈: 시드·리스트의 오타/띄어쓰기/약칭은 원칙적으로 수정 대상 아님(합의)

3. 증강 전략
   -1. 규칙 기반 + LLM 하이브리드
       - 단순 치환만으로는 조사/조어가 깨지므로, 엔티티 치환은 규칙, 문장 흐름 보정은 LLM으로 후편집.
       - while 루프 + 사용 엔티티 캐시로 중복 사용 방지 및 케이스 다양화.
   -2. 엔티티 사전 구축/보강
       - 관공서 리스트(최종), 문서별 POS 리스트, 경찰청–휘하 경찰서 매핑 수집·정제.
       - 누락 확인(예: 가정법원) 시 즉시 리스트 보강 및 코드 반영.
   -3. 카테고리별 증강 로직
       - 법원: 법원 엔티티만 교체(다른 ORG 태그는 그대로).
       - 금융/영장/세무: 고객사 합의된 메인 관공서만 교체 대상.
       - 리스트가 org-case만 있는 경우, 원문 dep/team 태그는 삭제 후 org-case로만 치환.
   -4. 문장 재배열/동의어 치환
       - 문장 순서/표현 변형은 문맥을 유지하는 범위 내에서 LLM으로 자연화.
       - 숫자/고유 식별자 등 비치환 필드 잠금(NER 키 보호)

4. 품질 통제(Validation)
   - NE 일관성: 생성 결과에도 NER 태깅 재적용(내부 룰 기반)
   - POS/계층 검증: 교체된 엔티티가 허용 POS 및 org-dep-team-case 종속성을 지키는지 체크
   - 누락·오염 값 처리: "word": "nan" 등 노이즈 필드 제거 및 NER 리스트 생성 제외
   - 라운드트립 테스트: 증강→파싱→검수 파이프라인에서 형식·키 유효성 연쇄 점검

5. 모델/도구
   - LLM: GPT-4o 중심(초기 비교에서 Claude-3.5 대비 결과물 깔끔함)
   - 코드: 파이썬(엔티티 매핑/치환 엔진, 중복 방지, 유효성 검사), 시트/엑셀 기반 가이드 ingest

6. 협의 이슈 & 해결
   - 시드 부족 vs 목표물량: 법원 시드가 적어 리스트 조합만으로 경우의 수 부족 → POS/이름 치환 병행으로 규모 확보(합의)
   - 누락 엔티티: 가정법원 등 리스트 미포함 항목 발견 → 고객사와 즉시 공유 후 리스트 업데이트
   - 휘하 조직 정합성: 경찰조직은 상위–하위 종속을 기반으로만 치환하도록 룰 고정
   - 모델 한계: “치환 금지” 안내에도 LLM이 부가 텍스트를 생성하는 사례 → 후처리 필터로 제거

7. 산출물/진척
   - 시범 1,000건(법원 중심) 우선 증강·제출 → 피드백 반영
   - 이후 카테고리별 규칙 확정 및 스케일 아웃(증강 5배수 목표 기준으로 파이프라인 준비)
   - 결과물은 원본 파일명 기반 증강 인덱스(_1, _2, …) 부여

8. 리스크·한계
   -1. 엔티티 커버리지 의존: 리스트 빈틈(약칭/오타/신설 조직)은 즉시 영향 → 지속 보강 체계 필요
   -2. 모델 환각: 지침 위반 텍스트 삽입·형식 붕괴 간헐 발생 → 후처리 필터로 완전 제거는 어려움
   -3. POS 일관성: 시드 태깅의 **오류(POS 오타 등)**가 있으면 정확한 치환 곤란
   -4. 조사/어미 자연화: LLM 보정으로 개선되나 완전 자동 일치 보장은 어려움(검수 샘플링 필요)

9. 성과(정량적 과장 없음)
   -1. 규칙×LLM 병행 증강 파이프라인 구축: 카테고리·조직 계층·POS 제약을 자동 준수
   -2. 시범 증강을 통해 고객사 세부 규칙 확정(메인 관공서, POS 허용, 누락 보강 등)
   -3. 증강 데이터에 NER 재적용 절차 마련 → 후속 태깅·모델 학습 단계 연결
